<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
	<title>Store</title>
    </h:head>

    <h:body>
        <div>
            <div style="position: relative; left:20%; display: inline-block; text-align: center;">
                <h:outputText value="Welcome to the store"/><br/><br/>
                <h:form>
                     <h:inputText id="search" value="#{ProductCatalogue.searchedString}" valueChangeListener="#{ProductCatalogue.searchedTextChanged}"
                                 style="width: 250px; text-align: center;">
                        <f:ajax execute="search" render=":form:panel" event="blur"/>
                    </h:inputText><br/><br/>
                    <h:outputText value="#{ProductCatalogue.productDetail}"/>
                </h:form>

                <h:form id="form">
		    <h:panelGroup id="panel">
			<h:panelGrid bgcolor="#e6edfd" columns="1">
			<h:dataTable id="table" value="#{ProductCatalogue.productsList}" var="p" style="text-align: left;">
			    <h:column>
				<f:facet name="header">Name</f:facet>
				    #{p.productName}
			    </h:column>

			    <h:column>
				<f:facet name="header">Units</f:facet>
				    #{p.quantityPerUnit}
			    </h:column>

			    <h:column>
				<f:facet name="header">Price</f:facet>
				    #{p.unitPrice.setScale(2)}
			    </h:column>

			    <h:column>
				<f:facet name="header">Quantity</f:facet>
                                <h:commandButton value="-" action="#{CartController.alterProductCart(p.productId, '-')}"></h:commandButton>
				#{CartController.productCart[p]}
				<h:commandButton value="+" action="#{CartController.alterProductCart(p.productId, '+')}"></h:commandButton>
			    </h:column>

			    <h:column>
				<h:commandButton value="Info" action="#{ProductCatalogue.getProductsInfo(p)}"/>
			    </h:column>
			</h:dataTable>
			</h:panelGrid>
		    </h:panelGroup>
                </h:form>
            </div>

            <div style="position: absolute; display: inline-block; margin-left: 25%;">
                <h:form>
                    <h:panelGrid bgcolor="#e6edfd" columns="1">
                        <f:facet name="header">Product Cart</f:facet>

                        <h:outputText value="Total price: #{CartController.totalCartPrice}"/>   

                        <h:dataTable value="#{CartController.cartProducts}" var="p" style="text-align: left;">

                            <h:column>
                                <f:facet name="header">Name</f:facet>
				    #{p.productName}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Units</f:facet>
				    #{p.quantityPerUnit}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Quantity</f:facet>
                                <h:commandButton value="-" action="#{CartController.alterProductCart(p.productId, '-')}"/>
                                #{CartController.productCart[p]}
                                <h:commandButton value="+" action="#{CartController.alterProductCart(p.productId, '+')}"/>
                            </h:column>

                            <h:column>
                                <f:facet name="header">Price</f:facet>
				    #{p.unitPrice.setScale(2) * CartController.productCart[p]}
                            </h:column>
                        </h:dataTable>
                        <h:commandButton value="Go to checkout" action="#{CartController.createOrder()}" style="float: right;"/>
                    </h:panelGrid>
                </h:form>
            </div>
        </div>       
    </h:body>
</html>
